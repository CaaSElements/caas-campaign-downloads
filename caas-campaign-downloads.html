<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">

<!--
`caas-campaign-downloads`
Polymer Campaign Downloads Element for Crowdfunding as a Service Solutions

@demo demo/index.html 
-->

<dom-module id="caas-campaign-downloads">
  <template>

    <iron-ajax
      id="getCampaignFiles"
      url="[[apiEndpoint]]/campaigns/[[campaignId]]/publicfiles"
      handle-as="json"
      method="GET"
      last-response="{{_apiData}}"
      debounce-duration="3000"
    ></iron-ajax>

    <style>
      :host {
        display: block;
      }
    </style>

  </template>

  <script>
    Polymer({

      is: 'caas-campaign-downloads',

      properties: {

        apiEndpoint: {
          type: String
        },

        campaignId: {
          type: String
        },

        items: {
          type: Array,
          computed: '_computeItems(_apiData.files.*)',
          notify: true
        }

      },

      observers: [
        '_getApiData(apiEndpoint, campaignId)'
      ],

      _getApiData: function(apiEndpoint, campaignId) {
        this.$.getCampaignFiles.generateRequest();
      },

      _computeItems(file) {
        if(!file || !file.base || !file.base.map) return [];
        return file.base.map(this._parseItemObject);
      },

      _parseItemObject: function(file) {
        return {
          name: file.fileName,
          url: file.url,
          description: file.description,
          size: file.fileSize
        }
      }

    });
  </script>
</dom-module>
